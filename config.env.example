#!/bin/bash
# Azure Red Hat OpenShift Secrets Store CSI Driver Configuration
# Copy this file to config.env and update the values according to your environment

# Azure Configuration
# Note: Subscription ID and Tenant ID are automatically fetched from Azure CLI by the script
# You can override them here if needed, but they're optional since they're fetched dynamically
# Leave empty or omit to have the script fetch from: az account show
export AZURE_SUBSCRIPTION_ID=""
export AZURE_TENANT_ID=""

# These values must be set (not fetched automatically):
export AZURE_RESOURCE_GROUP="your-resource-group"
export AZURE_LOCATION="your-location"
export AZURE_CLUSTER_NAME="your-cluster-name"

# Resource Prefix (used to identify resources created by this script)
# All resources created by this script will have this prefix
# Cleanup will only delete resources with this prefix
export AZURE_RESOURCE_PREFIX="aro-secrets-"

# Key Vault Configuration
# Note: The actual Key Vault name will be: ${AZURE_RESOURCE_PREFIX}${KEYVAULT_NAME}
# 
# ⚠️  IMPORTANT: Azure Key Vault naming requirements:
#   - Total length (prefix + base name) must be 3-24 characters
#   - Must begin with a letter
#   - Must end with a letter or digit  
#   - Only alphanumeric characters and hyphens allowed
#   - No consecutive hyphens
#
# Examples:
#   ✅ Valid: prefix="aro-secrets-" (13) + KEYVAULT_NAME="test" (4) = 17 chars
#   ✅ Valid: prefix="aro-" (4) + KEYVAULT_NAME="secrets-test" (12) = 16 chars
#   ❌ Invalid: prefix="aro-secrets-" (13) + KEYVAULT_NAME="test-jjohanss" (13) = 26 chars (too long!)
#
# Recommendation: With default prefix "aro-secrets-" (13 chars), keep KEYVAULT_NAME ≤ 11 characters
export KEYVAULT_NAME="your-keyvault-name"
# KEYVAULT_URL will be auto-generated from the actual Key Vault name

# Service Principal Configuration
# Note: The actual Service Principal name will be: ${AZURE_RESOURCE_PREFIX}${SERVICE_PRINCIPAL_NAME}
# Service Principal Client ID is automatically fetched from Azure by display name if not set
# Service Principal Client Secret must be set (or reset using: az ad sp credential reset --id <CLIENT_ID>)
export SERVICE_PRINCIPAL_NAME="csi-driver-sp"
export SERVICE_PRINCIPAL_CLIENT_ID="${SERVICE_PRINCIPAL_CLIENT_ID:-}"
export SERVICE_PRINCIPAL_CLIENT_SECRET="${SERVICE_PRINCIPAL_CLIENT_SECRET:-}"

# Authentication Method Configuration
# Only Service Principal is supported
export AUTH_METHOD="service-principal"
export USE_WORKLOAD_IDENTITY="false"

# Kubernetes Configuration
export NAMESPACE="openshift-cluster-csi-drivers"
export OPERATOR_NAMESPACE="openshift-cluster-csi-drivers"
export SERVICE_ACCOUNT_NAME="secrets-store-csi-driver"

# OIDC Configuration (optional, for future use)
export OIDC_ISSUER_URL="https://your-oidc-issuer-url"

# Test Configuration
export TEST_NAMESPACE="secrets-store-test"
export TEST_SERVICE_ACCOUNT="secrets-store-test-sa"

# Secret Names in Key Vault
export SECRET_DATABASE_PASSWORD="database-password"
export SECRET_API_KEY="api-key"
export SECRET_TLS_CERT="webapp-tls-cert"
export SECRET_ENCRYPTION_KEY="encryption-key"

# Display configuration
echo "Azure Configuration:"
echo "  Subscription ID: $AZURE_SUBSCRIPTION_ID"
echo "  Tenant ID: $AZURE_TENANT_ID"
echo "  Resource Group: $AZURE_RESOURCE_GROUP"
echo "  Location: $AZURE_LOCATION"
echo "  Cluster Name: $AZURE_CLUSTER_NAME"
echo ""
echo "Authentication Configuration:"
echo "  Method: service-principal (only supported method)"
echo "  Service Principal: $SERVICE_PRINCIPAL_NAME"
echo "  Client ID: $SERVICE_PRINCIPAL_CLIENT_ID"
echo ""
echo "Key Vault Configuration:"
echo "  Name: $KEYVAULT_NAME"
echo "  URL: $KEYVAULT_URL"
echo ""
echo "Kubernetes Configuration:"
echo "  Namespace: $NAMESPACE"
echo "  Service Account: $SERVICE_ACCOUNT_NAME"
echo ""
echo "Test Configuration:"
echo "  Test Namespace: $TEST_NAMESPACE"
echo "  Test Service Account: $TEST_SERVICE_ACCOUNT"

